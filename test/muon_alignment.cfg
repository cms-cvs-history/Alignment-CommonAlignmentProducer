process MuonAlignment = {
    include "FWCore/MessageService/data/MessageLogger.cfi"
    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
    include "Geometry/CommonDetUnit/data/bareGlobalTrackingGeometry.cfi"
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"
    include "Geometry/RPCGeometry/data/rpcGeometry.cfi"
    include "TrackingTools/TrackRefitter/data/TracksToTrajectories.cff"
    include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilderWithoutRefit.cfi"
    module TrackRefitter = TracksToTrajectories {
	InputTag Tracks = ALCARECOMuAlZMuMu:StandAlone
	PSet TrackTransformer = {
	    string Fitter = "KFFitterForRefitOutsideIn"
	    string Smoother = "KFSmootherForRefitOutsideIn"
	    string TrackerRecHitBuilder = "WithoutRefit"
	    string MuonRecHitBuilder = "MuonRecHitBuilder"
	    string RefitDirection = "outsideIn"
	}
    }

    include "Alignment/CommonAlignmentProducer/data/AlignmentProducer.cff"
    replace AlignmentProducer.doMisalignmentScenario = false
    replace AlignmentProducer.tjTkAssociationMapTag = TrackRefitter
    replace AlignmentProducer.doTracker = false
    replace AlignmentProducer.doMuon    = true
    replace AlignmentProducer.ParameterBuilder.Selector.alignParams = {"MuonDTWheels,111111", "MuonCSCStations,111111"}
#     replace AlignmentProducer.ParameterBuilder.Selector.alignParams = {"MuonDTChambers,111111", "MuonCSCChambers,111111"}
#     replace AlignmentProducer.ParameterBuilder.Selector.alignParams = {"MuonDTSuperLayers,111111", "MuonCSCLayers,111111"}

    replace AlignmentProducer.monitorConfig = {
	untracked vstring monitors = {"AlignmentMonitorMuonHIP"}
	untracked PSet AlignmentMonitorMuonHIP = {
	    string outpath = "./"
	    string outfile = "histograms.root"
	    
	    bool collectorActive = false
	    int32 collectorNJobs = 0
	    string collectorPath = "./"

	    PSet params = {
		uint32 iterations = 11
		double iterations_low = -0.5
		double iterations_high = 10.5
		uint32 bins = 100
		double xresid_low = -1.
		double xresid_high = 1.
		double xresidwide_low = -5.
		double xresidwide_high = 5.
		double yresid_low = -5.
		double yresid_high = 5.
		double xDT_low = -300.
		double xDT_high = 300.
		double yDT_low = -300.
		double yDT_high = 300.
		double xCSC_low = -300.
		double xCSC_high = 300.
		double yCSC_low = -300.
		double yCSC_high = 300.
	    }

	    PSet book = {
		bool nhits_vsiter = false
		bool conv_x = false
		bool conv_y = false
		bool conv_z = false
		bool conv_phix = false
		bool conv_phiy = false
		bool conv_phiz = false
		bool xresid = false
		bool xresidwide = false
		bool yresid = false
		bool wxresid = false
		bool wxresidwide = false
		bool wyresid = false
		bool wxresid_vsx = false
		bool wxresid_vsy = false
		bool wyresid_vsx = false
		bool wyresid_vsy = false
		bool before = false
		bool after = false
	    }

	    bool createPythonGeometry = false
	}
    }

    source = PoolSource { 
        untracked vstring fileNames = {
	    "rfio:///castor/cern.ch/user/p/pivarski/AlCaRecoMu/zmumu/zmumu001.root",
	    "rfio:///castor/cern.ch/user/p/pivarski/AlCaRecoMu/zmumu/zmumu002.root"
	}
        untracked uint32 skipEvents = 0
    }	
    untracked PSet maxEvents = {untracked int32 input = -1}

    path p = {TrackRefitter}
}
